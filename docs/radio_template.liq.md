# Liquidsoap template (liquidsoap/radio_template.liq)

Purpose

Template Liquidsoap script used by the core app. The Node.js code reads this template, replaces two placeholders and writes the result to the Liquidsoap scripts directory before starting the Liquidsoap process.

Placeholders

- `{PWD}` — replaced with `process.env.LIQUIDSOAP_PWD` (used as Icecast password)
- `{LOG}` — replaced with an absolute path to `liquidsoap/liquidsoap.log` generated by `streamManager.js`

Key components in the template

- Telnet server
  - `settings.server.telnet := true`
  - `settings.server.telnet.port := 1234`
  - Liquidsoap `server.register` is used to expose small helper functions in the `coldorbit` namespace:
    - `coldorbit.length` — returns queue length
    - `coldorbit.current` — returns currently playing request URI
    - `coldorbit.push <track_uri>` — pushes a request into the `radio_queue`

- Queue setup
  - `radio_queue = request.queue(id="coldorbit")`
  - `radio = fallback([crossfade(radio_queue), blank(duration=10.)])`
  - The template now includes tuning variables (example: `crossfade_seconds`, `blank_seconds`) to make timing easier to adjust in a single place.

- Output
  - `output.icecast(%ffmpeg(format="mp3", %audio(codec="libmp3lame")), host = "localhost", port = 8000, password = "{PWD}", mount = "radio.mp3", name = "Cold Orbit Radio", description = "Interplanetary broadcast station", genre = "Various", radio)

Notes on compatibility

- Liquidsoap syntax can vary between versions; keep the template minimal and test changes locally. If Liquidsoap fails to parse the generated `radio.liq`, the parse error line/char reported in the logs is the primary clue. When in doubt, revert to the simpler template (no List.map/String.concat usage) as used in this project.

Notes for integrators

- The Node.js code expects responses from the telnet functions to be plain text and — if possible — to end with `END` (the `LiquidSoapClient` strips a trailing `END`). Liquidsoap's `server.register` returns strings by default and the template already wraps values in `"#{...}"`.
- If you change function names or the port, update `streamManager.js` and `LiquidSoapClient.js` accordingly.
